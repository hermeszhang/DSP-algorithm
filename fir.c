/****************************************************************************/
/*                                                                          */
/*              有限长单位冲激响应滤波器测试                                */
/*                                                                          */
/*              2014年07月11日                                              */
/*                                                                          */
/****************************************************************************/
#include "math.h"                   // C 数学函数库

#include "mathlib.h"                // DSP 数学函数库
#include "dsplib.h"                 // DSP 函数库

/****************************************************************************/
/*                                                                          */
/*              宏定义                                                      */
/*                                                                          */
/****************************************************************************/
// 软件断点
#define SW_BREAKPOINT     asm(" SWBP 0 ");

// 有限长单位冲激响应滤波器
// π 及 浮点数极小值
#define PI                3.1415926535
#define F_TOL             (1e-06)

/****************************************************************************/
/*                                                                          */
/*              全局变量                                                    */
/*                                                                          */
/****************************************************************************/
// 有限长单位冲激响应滤波器测试
// 样品数
#define Tn  1024
// 采样频率
#define Fs  1000.0
// 滤波器阶数
#define N 32

// 信号
// FIR 输入信号
#pragma DATA_ALIGN(FIR_In, 8);
float FIR_In[Tn];

// FIR 输出
#pragma DATA_ALIGN(FIR_Out, 8);
float FIR_Out[Tn];

// FIR 系数
// 使用 Matlab Filter Design &  Analysis Tool 工具生成
#pragma DATA_ALIGN (B, 8);
const float B[N] =
{
		  -5.061877164e-05, -9.336374205e-05,  0.0003678254143,   0.0005914540961, -0.001496405224,
		  -0.002226336394,   0.004491201602,   0.006349918433,   -0.01111812051,   -0.01528073754,
		   0.02449801192,    0.03380065784,   -0.0527959317,     -0.0793820098,     0.1454829872,
		   0.4468590915,     0.4468590915,     0.1454829872,     -0.0793820098,    -0.0527959317,
		   0.03380065784,    0.02449801192,   -0.01528073754,    -0.01111812051,    0.006349918433,
		   0.004491201602,  -0.002226336394,  -0.001496405224,    0.0005914540961,  0.0003678254143,
		  -9.336374205e-05, -5.061877164e-05
};

/****************************************************************************/
/*                                                                          */
/*              函数声明                                                    */
/*                                                                          */
/****************************************************************************/
// FIR 测试
void FIRTest();

/****************************************************************************/
/*                                                                          */
/*              主函数                                                      */
/*                                                                          */
/****************************************************************************/
int main(void)
{
	// FIR 测试
	FIRTest();

	// 断点
	SW_BREAKPOINT;
}

/****************************************************************************/
/*                                                                          */
/*              有限长单位冲激响应滤波器测试                                */
/*                                                                          */
/****************************************************************************/
void FIRTest(void)
{
	// 产生待测试信号 100hz信号 450hz噪声
	unsigned int i;
	for (i=0;i<Tn;i++)
		FIR_In[i]=5*sin(2*PI*100*(i/Fs))+15*sin(2*PI*450*(i/Fs));

	// FIR 滤波
	 DSPF_sp_fir_r2(FIR_In,B,FIR_Out,N,Tn);
}
